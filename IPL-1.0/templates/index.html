<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cricket Scorecard Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #f0f4f8;
            padding-top: 20px; /* Added padding to avoid content touching top edge */
            padding-bottom: 20px; /* Added padding to avoid content touching bottom edge */
        }
        .container {
            max-width: 800px;
            margin: auto;
            background-color: #ffffff;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            padding: 20px;
            border-radius: 8px; /* Added border-radius for container */
        }
        .team-selection {
            margin-bottom: 20px;
            padding: 20px; /* Increased padding */
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #e9ecef;
        }
        h2 {
            text-align: center;
            color: #333;
        }
        h3 {
            text-align: center;
            color: #333;
            margin-bottom: 15px; /* Added margin for spacing */
        }
        h4 {
            text-align: center;
            color: #333;
            margin-top: 20px; /* Added margin for spacing */
            margin-bottom: 10px; /* Added margin for spacing */
        }
        h5 { /* For Bowling titles */
            color: #333;
            margin-top: 15px;
            margin-bottom: 5px;
        }
        label {
            margin-right: 10px;
        }
        select {
            padding: 10px;
            margin-right: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            min-width: 100px; /* Ensure select boxes have a decent width */
        }
        button { /* Default button style */
            padding: 10px 15px;
            margin-right: 10px; /* Default margin, specific buttons can override */
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3; /* Darker shade on hover */
        }
        .sim-button { /* Style for the new simulation buttons */
            margin-left: 10px;
            margin-right: 10px;
            padding: 10px 20px; /* A bit more prominent */
        }
        button:disabled { /* Style for disabled button (though not directly used for sim buttons now) */
            background-color: #cccccc;
            color: #666666;
            cursor: not-allowed;
            opacity: 0.5;
        }
        .scorecard-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fff;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #007bff;
            color: white;
            border-bottom: 2px solid #0056b3;
        }
        tbody tr:nth-child(odd) {
            background-color: #f9f9f9;
        }
        tbody tr:hover {
            background-color: #f1f1f1;
        }
        .hidden {
            display: none;
        }
        .match-summary {
            background-color: #e7f3fe;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            border: 1px solid #b8daff;
        }
        .match-summary h4 {
            text-align: left;
            margin-top: 0;
        }
        .result-highlight {
            margin-top: 20px;
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            padding: 15px;
            text-align: center;
            border-radius: 5px;
        }
        .result-highlight p strong {
            font-size: 1.1em;
            font-weight: bold;
        }
        hr {
            border: 0;
            height: 1px;
            background: #ddd;
            margin-top: 25px;
            margin-bottom: 25px;
        }
        p strong {
            font-size: 1.05em;
        }
        .commentary-section {
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .commentary-header {
            background-color: #6c757d;
            color: white;
            padding: 10px;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
        }
        .commentary-header:hover {
            background-color: #5a6268;
        }
        .commentary-content {
            padding: 10px;
            border-top: 1px solid #ddd;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }
        .commentary-content p {
            margin: 5px 0;
            font-size: 0.9em;
            border-bottom: 1px dashed #eee;
            padding-bottom: 5px;
        }
        .commentary-content p:last-child {
            border-bottom: none;
        }

        /* Team Grid Styles START */
        .team-grid-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
            padding: 10px;
        }
        .team-box {
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
            border-radius: 10px;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .team-box:hover {
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        .team-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: contain;
            margin-bottom: 10px;
            background-color: #ffffff;
            padding: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .team-name {
            font-weight: bold;
            font-size: 0.9em;
            color: #333;
            margin-top: 5px;
        }
        .team-box.selected-team1, .team-box.selected-team2 {
            box-shadow: 0 0 15px rgba(0, 123, 255, 0.5), 0 0 0 3px rgba(0, 123, 255, 0.7);
        }
        /* Team Grid Styles END */
    </style>
</head>
<body>
    <div class="container">
        <h2>Cricket Scorecard Generator</h2>

        <div class="team-selection">
            <h3>Select Teams (Click to Select)</h3>
            <form id="scorecardForm" action="/generate_scorecard" method="post">
                <input type="hidden" name="selectedTeam1" id="selectedTeam1"> <!-- name attribute changed -->
                <input type="hidden" name="selectedTeam2" id="selectedTeam2"> <!-- name attribute changed -->

                <div class="team-grid-container">
                    {% for team_code, team_data in teams.items() %}
                    <div class="team-box"
                         data-team-code="{{ team_code }}"
                         data-full-name="{{ team_data.fullName }}"
                         data-primary-color="{{ team_data.colorPrimary }}"
                         data-secondary-color="{{ team_data.colorSecondary }}"
                         style="border: 2px solid {{ team_data.colorPrimary }};">
                        <img src="{{ team_data.logo }}" alt="{{ team_data.fullName }} Logo" class="team-logo">
                        <p class="team-name">{{ team_data.name.upper() }}</p>
                    </div>
                    {% endfor %}
                </div>
                <!-- New Simulation Options Buttons START -->
                <div class="simulation-options" style="text-align: center; margin-top: 20px; display: none;">
                    <button type="submit" name="simulation_type" value="direct" id="directSimButton" class="sim-button">Direct Scorecard</button>
                    <button type="submit" name="simulation_type" value="ball_by_ball" id="ballByBallSimButton" class="sim-button">Ball-by-Ball Simulation</button>
                </div>
                <!-- New Simulation Options Buttons END -->
            </form>
        </div>

        {% if scorecard_data %}
        <div class="scorecard-section">
            <h3>Match Results</h3>

            {% if scorecard_data.tossMsg %}
            <div class="match-summary">
                <h4>Toss</h4>
                <p>{{ scorecard_data.tossMsg }}</p>
            </div>
            {% endif %}

            {% if scorecard_data.innings1BatTeam %}
            <h4>Innings 1: {{ scorecard_data.innings1BatTeam.upper() }}</h4>
            <table>
                <thead>
                    <tr>
                        <th>Player</th>
                        <th>Runs</th>
                        <th>Balls</th>
                        <th>SR</th>
                        <th>How Out</th>
                    </tr>
                </thead>
                <tbody>
                    {% for player, stats in scorecard_data.innings1Battracker.items() %}
                    <tr>
                        <td>{{ player }}</td>
                        <td>{{ stats.runs }}</td>
                        <td>{{ stats.balls }}</td>
                        <td>{{ '%.2f'|format((stats.runs / stats.balls * 100) if stats.balls > 0 else 0) }}</td>
                        <td>{{ stats.how_out }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <p><strong>Total: {{ scorecard_data.innings1Runs }}/{{ scorecard_data.innings1Wickets }} ({{ scorecard_data.innings1Balls // 6 }}.{{ scorecard_data.innings1Balls % 6 }} Overs)</strong></p>

            <h5>Bowling: {{ scorecard_data.innings2BatTeam.upper() }}</h5>
            <table>
                <thead>
                    <tr>
                        <th>Player</th>
                        <th>Overs</th>
                        <th>Runs</th>
                        <th>Wickets</th>
                        <th>Economy</th>
                    </tr>
                </thead>
                <tbody>
                    {% for player, stats in scorecard_data.innings1Bowltracker.items() %}
                    <tr>
                        <td>{{ player }}</td>
                        <td>{{ stats.balls // 6 }}.{{ stats.balls % 6 }}</td>
                        <td>{{ stats.runs }}</td>
                        <td>{{ stats.wickets }}</td>
                        <td>{{ '%.2f'|format((stats.runs / (stats.balls / 6)) if stats.balls > 0 else 0) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}

            {% if scorecard_data.innings1Log %}
            <div class="commentary-section">
                <div class="commentary-header" onclick="toggleCommentary('commentary1')">
                    Innings 1: Over-by-Over Log &#9662; <!-- Down arrow -->
                </div>
                <div class="commentary-content" id="commentary1">
                    {% for log_entry in scorecard_data.innings1Log %}
                        <p>{{ log_entry.event }}</p>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <hr>

            {% if scorecard_data.innings2BatTeam %}
            <h4>Innings 2: {{ scorecard_data.innings2BatTeam.upper() }}</h4>
            <table>
                <thead>
                    <tr>
                        <th>Player</th>
                        <th>Runs</th>
                        <th>Balls</th>
                        <th>SR</th>
                        <th>How Out</th>
                    </tr>
                </thead>
                <tbody>
                    {% for player, stats in scorecard_data.innings2Battracker.items() %}
                    <tr>
                        <td>{{ player }}</td>
                        <td>{{ stats.runs }}</td>
                        <td>{{ stats.balls }}</td>
                        <td>{{ '%.2f'|format((stats.runs / stats.balls * 100) if stats.balls > 0 else 0) }}</td>
                        <td>{{ stats.how_out }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <p><strong>Total: {{ scorecard_data.innings2Runs }}/{{ scorecard_data.innings2Wickets }} ({{ scorecard_data.innings2Balls // 6 }}.{{ scorecard_data.innings2Balls % 6 }} Overs)</strong></p>

            <h5>Bowling: {{ scorecard_data.innings1BatTeam.upper() }}</h5>
            <table>
                <thead>
                    <tr>
                        <th>Player</th>
                        <th>Overs</th>
                        <th>Runs</th>
                        <th>Wickets</th>
                        <th>Economy</th>
                    </tr>
                </thead>
                <tbody>
                    {% for player, stats in scorecard_data.innings2Bowltracker.items() %}
                    <tr>
                        <td>{{ player }}</td>
                        <td>{{ stats.balls // 6 }}.{{ stats.balls % 6 }}</td>
                        <td>{{ stats.runs }}</td>
                        <td>{{ stats.wickets }}</td>
                        <td>{{ '%.2f'|format((stats.runs / (stats.balls / 6)) if stats.balls > 0 else 0) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}

            {% if scorecard_data.innings2Log %}
            <div class="commentary-section">
                <div class="commentary-header" onclick="toggleCommentary('commentary2')">
                    Innings 2: Over-by-Over Log &#9662; <!-- Down arrow -->
                </div>
                <div class="commentary-content" id="commentary2">
                    {% for log_entry in scorecard_data.innings2Log %}
                        <p>{{ log_entry.event }}</p>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {% if scorecard_data.winMsg %}
            <div class="match-summary result-highlight">
                <h4>Result</h4>
                <p><strong>{{ scorecard_data.winMsg }}</strong></p>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>
    <script>
        function toggleCommentary(commentaryId) {
            var content = document.getElementById(commentaryId);
            var header = content.previousElementSibling;
            if (content.style.display === "none" || content.style.display === "") {
                content.style.display = "block";
                header.innerHTML = header.innerHTML.replace("▼", "▲");
            } else {
                content.style.display = "none";
                header.innerHTML = header.innerHTML.replace("▲", "▼");
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            const teamBoxes = document.querySelectorAll('.team-box');
            const selectedTeam1Input = document.getElementById('selectedTeam1');
            const selectedTeam2Input = document.getElementById('selectedTeam2');
            const simulationOptionsDiv = document.querySelector('.simulation-options'); // Get the new div
            let team1 = null;
            let team2 = null;

            teamBoxes.forEach(box => {
                const primaryColor = box.dataset.primaryColor;
                const originalBackgroundColor = box.style.backgroundColor || 'white';
                const teamNameP = box.querySelector('.team-name');
                const originalTextColor = teamNameP.style.color || '#333';

                function getContrastYIQ(hexcolor){
                    hexcolor = hexcolor.replace("#", "");
                    var r = parseInt(hexcolor.substr(0,2),16);
                    var g = parseInt(hexcolor.substr(2,2),16);
                    var b = parseInt(hexcolor.substr(4,2),16);
                    var yiq = ((r*299)+(g*587)+(b*114))/1000;
                    return (yiq >= 128) ? '#333' : 'white';
                }

                const hoverTextColor = getContrastYIQ(primaryColor);

                box.addEventListener('mouseenter', function () {
                    if (!this.classList.contains('selected-team1') && !this.classList.contains('selected-team2')) {
                        this.style.backgroundColor = primaryColor;
                        teamNameP.style.color = hoverTextColor;
                    }
                });

                box.addEventListener('mouseleave', function () {
                    if (!this.classList.contains('selected-team1') && !this.classList.contains('selected-team2')) {
                        this.style.backgroundColor = originalBackgroundColor;
                        teamNameP.style.color = originalTextColor;
                    }
                });

                box.addEventListener('click', function () {
                    const teamCode = this.dataset.teamCode;
                    const clickedBoxPrimaryColor = this.dataset.primaryColor;
                    const clickedBoxTextColor = getContrastYIQ(clickedBoxPrimaryColor);

                    if (team1 === teamCode) {
                        team1 = null;
                        selectedTeam1Input.value = '';
                        this.classList.remove('selected-team1');
                        this.style.backgroundColor = originalBackgroundColor;
                        teamNameP.style.color = originalTextColor;
                    } else if (team2 === teamCode) {
                        team2 = null;
                        selectedTeam2Input.value = '';
                        this.classList.remove('selected-team2');
                        this.style.backgroundColor = originalBackgroundColor;
                        teamNameP.style.color = originalTextColor;
                    } else if (!team1) {
                        team1 = teamCode;
                        selectedTeam1Input.value = team1;
                        this.classList.add('selected-team1');
                        this.style.backgroundColor = clickedBoxPrimaryColor;
                        teamNameP.style.color = clickedBoxTextColor;
                    } else if (!team2) {
                        team2 = teamCode;
                        selectedTeam2Input.value = team2;
                        this.classList.add('selected-team2');
                        this.style.backgroundColor = clickedBoxPrimaryColor;
                        teamNameP.style.color = clickedBoxTextColor;
                    } else {
                        const oldTeam1Box = document.querySelector('.team-box.selected-team1');
                        if (oldTeam1Box) {
                            oldTeam1Box.classList.remove('selected-team1');
                            oldTeam1Box.style.backgroundColor = originalBackgroundColor;
                            oldTeam1Box.querySelector('.team-name').style.color = originalTextColor;
                        }
                        team1 = teamCode;
                        selectedTeam1Input.value = team1;
                        this.classList.add('selected-team1');
                        this.style.backgroundColor = clickedBoxPrimaryColor;
                        teamNameP.style.color = clickedBoxTextColor;
                    }
                    validateSelections();
                });
            });

            function validateSelections() {
                if (team1 && team2 && team1 !== team2) {
                    simulationOptionsDiv.style.display = 'block'; // Show simulation buttons
                } else {
                    simulationOptionsDiv.style.display = 'none'; // Hide simulation buttons
                }
            }

            validateSelections(); // Initial check

            document.getElementById('scorecardForm').addEventListener('submit', function(event) {
                // Basic validation, more specific validation can be added per button if needed
                if (!selectedTeam1Input.value || !selectedTeam2Input.value) {
                    event.preventDefault();
                    alert('Please select two teams to generate the scorecard.');
                } else if (selectedTeam1Input.value === selectedTeam2Input.value) {
                    event.preventDefault();
                    alert('Please select two different teams.');
                }
                // No need to check for simulation_type here as it's part of the clicked button
            });
        });
    </script>
</body>
</html>
